// i2_bot ‚Äì Instinct PokememBro Bot
// Copyright (c) 2017 Vladimir "fat0troll" Hodakov

package talkers

import (
	"github.com/go-telegram-bot-api/telegram-bot-api"
	"lab.pztrn.name/fat0troll/i2_bot/lib/config"
	"lab.pztrn.name/fat0troll/i2_bot/lib/dbmapping"
)

// AcademyMessage gives user link to Bastion
func (t *Talkers) AcademyMessage(update *tgbotapi.Update, playerRaw *dbmapping.Player) {
	message := ""

	if playerRaw.LeagueID > 1 {
		message = "–ò–¥–∏ –Ω–∞—Ö—É–π, —à–ø–∏–æ–Ω—Å–∫–æ–µ –æ—Ç—Ä–æ–¥—å–µ"
	} else if playerRaw.LeagueID == 0 {
		message = "–ó–∞–ø–æ–ª–Ω–∏ –ø—Ä–æ—Ñ–∏–ª—å –∏ –ø–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑"
	} else {
		message += "*–ê–∫–∞–¥–µ–º–∏—è –ò–Ω—Å—Ç–∏–Ω–∫—Ç–∞*\n"
		message += "–ß–∞—Ç –¥–ª—è –æ–±—É—á–µ–Ω–∏—è –Ω–æ–≤–∏—á–∫–æ–≤ –ø—Ä–µ–¥—É–º—Ä–æ—Å—Ç—è–º –∏–≥—Ä—ã —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω –ø–æ —Å—Å—ã–ª–∫–µ: https://t.me/joinchat/G2vME04jk02v2etRmumylg"
	}

	msg := tgbotapi.NewMessage(update.Message.Chat.ID, message)
	msg.ParseMode = "Markdown"

	c.Bot.Send(msg)
}

// BastionMessage gives user link to Bastion
func (t *Talkers) BastionMessage(update *tgbotapi.Update, playerRaw *dbmapping.Player) {
	message := ""

	if playerRaw.LeagueID > 1 {
		message = "–ò–¥–∏ –Ω–∞—Ö—É–π, —à–ø–∏–æ–Ω—Å–∫–æ–µ –æ—Ç—Ä–æ–¥—å–µ"
	} else if playerRaw.LeagueID == 0 {
		message = "–ó–∞–ø–æ–ª–Ω–∏ –ø—Ä–æ—Ñ–∏–ª—å –∏ –ø–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑"
	} else {
		message += "*–ë–∞—Å—Ç–∏–æ–Ω –ò–Ω—Å—Ç–∏–Ω–∫—Ç–∞*\n"
		message += "–û–±—â–∏–π —á–∞—Ç –ª–∏–≥–∏ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω –ø–æ —Å—Å—ã–ª–∫–µ: https://t.me/joinchat/G2vME0mIX-QHjjxE\\_JBzoQ"
	}

	msg := tgbotapi.NewMessage(update.Message.Chat.ID, message)
	msg.ParseMode = "Markdown"

	c.Bot.Send(msg)
}

// HelpMessage gives user all available commands
func (t *Talkers) HelpMessage(update *tgbotapi.Update, playerRaw *dbmapping.Player) {
	message := "*–ë–æ—Ç –ò–Ω—Å—Ç–∏–Ω–∫—Ç–∞ Enchanched.*\n\n"
	message += "–¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è: *" + config.VERSION + "*\n\n"
	message += "–°–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥\n\n"
	message += "+ /me ‚Äì –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å–≤–æ–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å –≤ –±–æ—Ç–µ\n"
	message += "+ /best ‚Äì –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª—É—á—à–∏—Ö –ø–æ–∫–µ–º–æ–Ω–æ–≤ –¥–ª—è –ø–æ–∏–º–∫–∏\n"
	message += "+ /pokedeks ‚Äì –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –±–æ—Ç—É –ø–æ–∫–µ–º–µ–º–æ–≤\n"
	message += "+ /academy ‚Äî –ê–∫–∞–¥–µ–º–∏—è –ò–Ω—Å—Ç–∏–Ω–∫—Ç–∞\n"
	message += "+ /bastion ‚Äî –ë–∞—Å—Ç–∏–æ–Ω –ò–Ω—Å—Ç–∏–Ω–∫—Ç–∞\n"
	if c.Users.PlayerBetterThan(playerRaw, "admin") {
		message += "+ /send\\_all _—Ç–µ–∫—Å—Ç_ ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –±–æ—Ç–∞\n"
		message += "+ /send\\_league _—Ç–µ–∫—Å—Ç_ ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –±–æ—Ç–∞, —É –∫–æ—Ç–æ—Ä—ã—Ö –ø—Ä–æ—Ñ–∏–ª—å –ª–∏–≥–∏ –ò–Ω—Å—Ç–∏–Ω–∫—Ç\n"
		message += "+ /chats ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≥—Ä—É–ø–ø, –≤ –∫–æ—Ç–æ—Ä—ã—Ö —Ä–∞–±–æ—Ç–∞–µ—Ç –±–æ—Ç.\n"
		message += "+ /squads ‚Äî –ø–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –æ—Ç—Ä—è–¥–æ–≤.\n"
		message += "+ /pin _–Ω–æ–º–µ—Ä–∞ —á–∞—Ç–æ–≤_ _—Ç–µ–∫—Å—Ç_ ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ —á–∞—Ç—ã —Å –Ω–æ–º–µ—Ä–∞–º–∏. –°–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ–∫—Å–∏ –∑–∞–ø–∏–Ω–µ–Ω–æ. –ü—Ä–∏–º–µ—Ä: \"/pin 2,3,5 –ø—Ä–∏–≤–µ—Ç –º–∏—Ä\". –í–Ω–∏–º–∞–Ω–∏–µ: –º–µ–∂–¥—É –Ω–æ–º–µ—Ä–∞–º–∏ —á–∞—Ç–æ–≤ —Å—Ç–∞–≤—è—Ç—Å—è –∑–∞–ø—è—Ç—ã–µ –±–µ–∑ –ø—Ä–æ–±–µ–ª–æ–≤! –í—Å—ë, —á—Ç–æ –∏–¥—ë—Ç –ø–æ—Å–ª–µ –≤—Ç–æ—Ä–æ–≥–æ –ø—Ä–æ–±–µ–ª–∞ –≤ –∫–æ–º–∞–Ω–¥–µ ‚Äî —Å–æ–æ–±—â–µ–Ω–∏–µ\n"
		message += "+ /pin\\_all _—Ç–µ–∫—Å—Ç_ ‚Äî –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ –≤–æ –≤—Å–µ –≥—Ä—É–ø–ø—ã, –≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –±–æ—Ç. –°–æ–æ–±—â–µ–Ω–∏–µ –±—É–¥–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø–∏–Ω–µ–Ω–æ.\n"
		message += "+ /orders ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ø—Ä–∏–∫–∞–∑—ã –Ω–∞ –∞—Ç–∞–∫—É\n"
	}
	if c.Users.PlayerBetterThan(playerRaw, "academic") {
		message += "+ /users ‚Äî  –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –±–æ—Ç–∞\n"
		message += "+ /find\\_user _—Å—Ç—Ä–æ–∫–∞_ ‚Äî –Ω–∞–π—Ç–∏ –∏–≥—Ä–æ–∫–∞ –≤ –±–æ—Ç–µ –ø–æ –µ–≥–æ –Ω–∏–∫—É –∏–ª–∏ –∏–º–µ–Ω–∏. –ù–∏–∫ –∏—â–µ—Ç—Å—è –±–µ–∑ —Å–æ–±–∞—á–∫–∏ –≤ –Ω–∞—á–∞–ª–µ\n"
	}
	message += "+ /help ‚Äì –≤—ã–≤–æ–¥–∏—Ç –¥–∞–Ω–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ\n"

	message += "\n\n"
	message += "–°–≤—è–∑–∞—Ç—å—Å—è —Å –∞–≤—Ç–æ—Ä–æ–º: @fat0troll\n"

	msg := tgbotapi.NewMessage(update.Message.Chat.ID, message)
	msg.ParseMode = "Markdown"

	c.Bot.Send(msg)
}

// FiveOffer sends all users with 5 pokeballs limit offer for increasing pokeballs limit
func (t *Talkers) FiveOffer(update *tgbotapi.Update) string {
	players := []dbmapping.Player{}

	err := c.Db.Select(&players, "SELECT p.* FROM players p, profiles pp WHERE p.id = pp.player_id AND pp.pokeballs = 5")
	if err != nil {
		c.Log.Error(err.Error())
		return "fail"
	}

	for i := range players {
		message := "–ü—Å—Å—Ç, —è —Ç—É—Ç –∑–∞–º–µ—Ç–∏–ª, —á—Ç–æ —É —Ç–µ–±—è –≤—Å–µ–≥–æ 5 –ø–æ–∫–µ–±–æ–ª–æ–≤? –•–æ—á–µ—à—å —É–≤–µ–ª–∏—á–∏—Ç—å –∏—Ö –ª–∏–º–∏—Ç –Ω–∞ 2 –∏–ª–∏ –¥–∞–∂–µ –±–æ–ª—å—à–µ? –£ –≤—Å–µ—Ö –∏–≥—Ä–æ–∫–æ–≤ –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å!\n\n1. –ü–µ—Ä–µ–π—Ç–∏ –ø–æ —Å—Å—ã–ª–∫–µ: https://telegram.me/storebot?start=pokemembrobot\n2. –ù–∞–∂–∞—Ç—å Start\n3. –í—ã–±—Ä–∞—Ç—å ‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è‚≠êÔ∏è\n4. –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –Ω–∞–ø–∏—Å–∞—Ç—å, —á—Ç–æ –≤–∞–º –Ω—Ä–∞–≤–∏—Ç—Å—è –≤ –∏–≥—Ä–µ (–Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ). –û—Å—Ç–∞–≤—å—Ç–µ –±–æ–ª—å—à–æ–π –∏ –∫—Ä–∞—Å–æ—á–Ω—ã–π –æ—Ç–∑—ã–≤!\n5. –ü–µ—Ä–µ—Å–ª–∞—Ç—å –ø–µ—Ä–µ–ø–∏—Å–∫—É —Å @storebot –≤ —Ç–µ—Ö –ø–æ–¥–¥–µ—Ä–∂–∫—É –∏–≥—Ä—ã @PBhelp<‚Äî —Ç–æ–ª—å–∫–æ –µ–º—É! –∏ –±–æ–ª—å—à–µ –Ω–∏–∫–æ–º—É! (—Å —Ç–µ–∫—Å—Ç–æ–º –≤–∞—à–µ–≥–æ –æ—Ç–∑—ã–≤–∞)\n6. –ü–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–ª—É—á–∏—Ç—å –±–æ–Ω—É—Å üéÅ +2 –∫ –ª–∏–º–∏—Ç—É ‚≠ïÔ∏è –ê –µ—Å–ª–∏ –æ—Ç–∑—ã–≤ –ø–æ–Ω—Ä–∞–≤–∏—Ç—Å—è –∞–¥–º–∏–Ω–∞–º (–∏ —ç—Ç–æ –±—ã–≤–∞–µ—Ç –æ—á–µ–Ω—å —á–∞—Å—Ç–æ), —Ç–æ –±–æ–Ω—É—Å –±—É–¥–µ—Ç –±–æ–ª—å—à–µ!\n7. –ü—Ä–æ–≤–µ—Ä–∫–∞ - –º–æ–∂–µ—Ç –∑–∞–Ω—è—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—Ä–µ–º—è. –ê–¥–º–∏–Ω—ã –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ –æ—Ç–≤–µ—Ç—è—Ç –≤–∞–º –æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö –ø—Ä–æ–≤–µ—Ä–∫–∏."

		msg := tgbotapi.NewMessage(int64(players[i].TelegramID), message)
		msg.ParseMode = "Markdown"

		c.Bot.Send(msg)
	}

	message := "Enlarge your pokeballs! –°–æ–æ–±—â–µ–Ω–∏–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ."

	msg := tgbotapi.NewMessage(update.Message.Chat.ID, message)
	msg.ParseMode = "Markdown"

	c.Bot.Send(msg)

	return "ok"
}
